import{V as B}from"./index-f99f6722.js";import{_ as O,a as _,v as o,o as l,c as I,k as h,j as k,x as g,y as c,U as C,W as j,L as D,D as T,A as U,g as E,w as F,p as R,f as w,M as L,H as K,J as N,N as Q,O as q,P as Z,z as A,t as H,G as i,l as S,V as $,Q as ee}from"./index-05e97a4c.js";import{C as te}from"./index-fc79d775.js";const ae={setup(){const f=_(o.sturow.planned_Number);return{declarationRemark:_(o.sturow.declarationRemark),data1:f,stusure:async()=>{var x;const t=document.querySelector(".xiubox1");document.querySelector(".xiubox2");var v=document.querySelector(".layui-textarea").value,r=t.querySelector('input[type="number"]').value;if(r===""||r==0||r<0)C.msg("拟计划数错误 请重新输入");else if((r>o.onumber*1.2||r<o.onumber*.8)&&o.abnormal==0)C.msg("拟计划数异常 请上传证明材料");else if(r>500)C.msg("拟计划数不能大于500");else if(v.length>50)C.msg("备注不能超过50字");else{console.log(o.onumber);const b=U.apiurl+"/api/TranscriptionPlan32/updata_declarationrecord",d={drid:o.studrid,plannedNumber:r,DeclarationRemark:v},s={method:"POST",headers:{"content-type":"application/json",Authorization:"Bearer "+(((x=JSON.parse(localStorage.getItem("takel")))==null?void 0:x.accessToken)||o.takel.accessToken)},body:JSON.stringify(d)};console.log(d),fetch(b,s).then(y=>y.json()).then(y=>{C.msg(y.message),j.api()}).then(y=>{console.log(y)})}}}}},oe={class:"all1box"},se={class:"xiubox1"},le=h("span",null,"拟计划数",-1),ne={class:"xiubox2"},ie=h("span",null,"备注",-1);function ce(f,m,p,t,v,r){const x=D,b=te,d=T;return l(),I("div",oe,[h("div",se,[le,k(),g(x,{modelValue:t.data1,"onUpdate:modelValue":m[0]||(m[0]=s=>t.data1=s),type:"number",max:300,min:0},null,8,["modelValue"])]),h("div",ne,[ie,k(),g(b,{id:"ni",placeholder:"请输入描述",modelValue:t.declarationRemark,"onUpdate:modelValue":m[1]||(m[1]=s=>t.declarationRemark=s)},null,8,["modelValue"])]),g(d,{style:{display:"flex",margin:"0 auto"},border:"green",onClick:t.stusure},{default:c(()=>[k("确定")]),_:1},8,["onClick"])])}const re=O(ae,[["render",ce]]);const de={setup(){const f=o.school.value.userId?o.school.value.userId:JSON.parse(localStorage.getItem("school")).userId,m=o.school.value.schoolName?o.school.value.schoolName:JSON.parse(localStorage.getItem("school")).schoolName,p=_([]),t=async()=>{j.api();var a=[];p.value.forEach(u=>{a.push(u.drid)}),L.api(a)},v=async(a,u)=>{K.api(a,u)},r=async a=>{N.confirm(a.auditRemark,{title:"查看原因"})},x=async a=>{j.api(),await Q.api(a)},b=async a=>{j.api(),await q.api(a)},d=async a=>{await s(),o.abnormal=a.abnormal,console.log(a.abnormal),o.onumber=a.orginal_Plan_Number,o.studrid=a.drid,o.sturow=a,N.open({type:"page",title:"修改相关信息",content:Z(re)})},s=async()=>{var z;console.log("成功调用了我");const a=U.apiurl+"/api/TranscriptionPlan32/get_declarationrecord?TranscribeId=2",u={method:"GET",headers:{Authorization:"Bearer "+(((z=JSON.parse(localStorage.getItem("takel")))==null?void 0:z.accessToken)||o.takel.accessToken)}};try{const X=await(await fetch(a,u)).json();o.studata.value=X.data,console.log(o.studata.value[0].state),p.value=o.studata.value,console.log(p.value)}catch(V){console.error("数据获取失败：",V)}};E(()=>{s()}),F(o.studata,()=>{p.value==o.studata.value?console.log("一样的"):s()},{immediate:!0}),R("fetchData",s);const y=async a=>{n.value=!0;try{await new Promise(u=>{setTimeout(()=>{p.value=loadDataSource(a.current,a.limit),u()},1e3)})}catch(u){console.error("数据加载失败：",u)}finally{n.value=!1}},M=_([{value:"",label:"",closable:!1}]);_([{value:"",label:"",closable:!1}]);const e=_(""),n=_(!1),J=_([]),G=w({current:1,limit:10,total:100}),P=_([{title:"中职学校代码",width:"50",key:"secondary_School_Id",fixed:"left",sort:"desc"},{title:"中职学校名称",width:"50",key:"secondary_School_Name",fixed:"left",sort:"desc"},{title:"中职专业代码",width:"50px",key:"secondary_Pmid"},{title:"中职专业名称",width:"50px",key:"secondary_Pmname"},{title:"专业代号",width:"50px",key:"pmMark"},{title:"原计划数",width:"40px",key:"orginal_Plan_Number",scopedSlots:{customRender:"Input1"}},{title:"拟计划数",width:"40px",key:"planned_Number"},{title:"备注",width:"20px",key:"declarationRemark"},{title:"状态",width:"40px",key:"state",customSlot:"word3"},{title:"操作",width:"40px",customSlot:"operator",key:"operator",fixed:"right",ignoreExport:!0}]),Y=(a,u)=>{p.value.forEach(z=>{z.id===u.id&&N.msg("Success",{icon:1},()=>{z.status=a})})},W=()=>{N.msg(J.value,{area:"50%"})};return{id:f,name:m,fetchData:_(s),handleFileUpload:v,openConfirm:r,giveall:t,data1:M,del:x,give:b,index:d,inputValue1:e,columns:P,dataSource:p,selectedKeys:J,page:G,change:y,changeStatus:Y,remove:W}}},ue={class:"container-demo"},me={class:"scroll-container1"},pe={class:"scroll-content"},_e={style:{height:"800px"}},he={class:"buttonbox"},ye={class:"button-row"},Ie={key:0,size:"xs",type:"primary",style:{"text-align":"center"}},xe={class:"button-row"},ke={key:0,id:"WcCc0",style:{color:"rgb(123, 123, 123)"}},ge={key:1,id:"WcCc1",style:{color:"rgb(36, 135, 255)"}},be={key:2,id:"WcCc2",style:{color:"rgb(26,188,156)"}},ve={key:3,id:"WcCc3",style:{color:"rgb(248, 50, 10)"}},fe={key:4,id:"WcCc4",style:{color:"rgb(36, 135, 255)"}},ze={key:5,id:"WcCc5",style:{color:"rgb(0, 0, 0)"}};function Ce(f,m,p,t,v,r){const x=A,b=$,d=T,s=ee,y=D,M=B;return l(),I("div",ue,[g(x,{theme:"green"},{title:c(()=>[k(" 欢迎:"+H(t.name),1)]),_:1}),h("div",me,[h("div",pe,[h("div",_e,[g(M,{resize:!1,height:"90%",columns:t.columns,"default-toolbar":!0,"data-source":t.dataSource,"selected-keys":t.selectedKeys,"onUpdate:selectedKeys":m[0]||(m[0]=e=>t.selectedKeys=e),onChange:t.change},{date:c(({row:e})=>[]),status:c(({row:e})=>[g(b,{"model-value":e.status,onChange:n=>t.changeStatus(n,e)},null,8,["model-value","onChange"])]),toolbar:c(()=>[g(d,{size:"sm",type:"primary",onClick:t.giveall},{default:c(()=>[k("提交全部申报")]),_:1},8,["onClick"])]),operator:c(({row:e})=>[h("div",he,[h("div",ye,[e.state==1||e.state==2||e.state==4||e.state==5?(l(),I("p",Ie,"暂不可操作")):i("",!0),e.state==0||e.state==3?(l(),S(d,{key:1,size:"xs",type:"primary",onClick:n=>t.give(e)},{default:c(()=>[k("申报")]),_:2},1032,["onClick"])):i("",!0),e.state==0||e.state==3?(l(),S(d,{key:2,size:"xs",onClick:n=>t.index(e)},{default:c(()=>[k("修改")]),_:2},1032,["onClick"])):i("",!0),e.abnormal==0&&(e.state==0||e.state==3)?(l(),S(s,{key:3,multiple:!0,size:10240,text:"上传文件",acceptMime:"application/pdf",style:{"margin-left":"10px"},headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIzOTc1IiwibmFtZSI6IjE0MzkzIiwidXNlcmlkIjoiMzk3NSIsImFjY291bnQiOiIxNDM5MyIsInVzZXJ0eXBlIjoiMCIsImVtaWFsIjoiIiwicGhvbmUiOiIiLCJzY2hvb2x0eXBlIjoiMSIsInNjaG9vbG5hbWUiOiLlt53ljJflubzlhL_luIjojIPpq5jnrYnkuJPnp5HlrabmoKEiLCJuYmYiOjE2OTk3NTUxMDMsImV4cCI6MTczMTI5MTEwMywiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDY1IiwiYXVkIjoiSFNDbGllbnQifQ.5G_Q4leGvJ7SWzh9AgKOv_nqGpSfUJizukSUKZ0CZ70"},data:e.ddird,onDone:n=>t.handleFileUpload(n,e)},null,8,["headers","data","onDone"])):i("",!0),e.abnormal==2&&(e.state==0||e.state==3)?(l(),S(s,{key:4,multiple:!0,size:10240,text:"重新上传",acceptMime:"application/pdf",style:{"margin-left":"10px"},headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIzOTc1IiwibmFtZSI6IjE0MzkzIiwidXNlcmlkIjoiMzk3NSIsImFjY291bnQiOiIxNDM5MyIsInVzZXJ0eXBlIjoiMCIsImVtaWFsIjoiIiwicGhvbmUiOiIiLCJzY2hvb2x0eXBlIjoiMSIsInNjaG9vbG5hbWUiOiLlt53ljJflubzlhL_luIjojIPpq5jnrYnkuJPnp5HlrabmoKEiLCJuYmYiOjE2OTk3NTUxMDMsImV4cCI6MTczMTI5MTEwMywiaXNzIjoiaHR0cDovL2xvY2FsaG9zdDo1MDY1IiwiYXVkIjoiSFNDbGllbnQifQ.5G_Q4leGvJ7SWzh9AgKOv_nqGpSfUJizukSUKZ0CZ70"},data:e.ddird,onDone:n=>t.handleFileUpload(n,e)},null,8,["headers","data","onDone"])):i("",!0)]),h("div",xe,[e.state==3?(l(),S(d,{key:0,size:"xs",type:"primary",onClick:n=>t.openConfirm(e)},{default:c(()=>[k("查看原因")]),_:2},1032,["onClick"])):i("",!0)])])]),word3:c(({row:e})=>[e.state===0?(l(),I("p",ke," 待提交 ")):i("",!0),e.state===1?(l(),I("p",ge," 审核中 ")):i("",!0),e.state===2?(l(),I("p",be," 待核对 ")):i("",!0),e.state===3?(l(),I("p",ve," 已退回 ")):i("",!0),e.state===4?(l(),I("p",fe," 待定稿 ")):i("",!0),e.state===5?(l(),I("p",ze," 已定稿 ")):i("",!0)]),Input2:c(({row:e})=>[g(y,{modelValue:e.planned_Number,"onUpdate:modelValue":n=>e.planned_Number=n,allowClear:"",placeholder:"请输入",style:{width:"180px"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["columns","data-source","selected-keys","onChange"])])])])])}const Me=O(de,[["render",Ce]]);export{Me as default};
